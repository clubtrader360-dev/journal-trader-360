<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trader360 â€“ Journal de Trading</title>

    <link rel="stylesheet" href="style.css">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

    <!-- ================= HEADER ================= -->
    <header>
        <h1>Trader360 â€“ Journal de Trading</h1>
        <button onclick="logout()">DÃ©connexion</button>
    </header>

    <!-- =============== SIDEBAR MENU ================ -->
    <aside class="sidebar">
        <ul>
            <li onclick="showSection('dashboard')">ğŸ“Š Dashboard</li>
            <li onclick="showSection('accounts')">ğŸ’¼ Comptes</li>
            <li onclick="showSection('trades')">ğŸ“ˆ Trades</li>
            <li onclick="showSection('coachPanel')">ğŸ§‘â€ğŸ« Coach</li>
        </ul>
    </aside>

    <!-- =============== MAIN CONTENT ================ -->
    <main>
        <!-- DASHBOARD -->
        <section id="dashboard" class="app-section visible">
            <h2>Dashboard</h2>
            <p>Bienvenue dans ton journal de trading Trader360</p>
        </section>

        <!-- ACCOUNTS SECTION -->
        <section id="accounts" class="app-section">
            <h2>Mes Comptes</h2>

            <button onclick="openModal('addAccountModal')" class="btn-primary">
                â• Ajouter un compte
            </button>

            <div id="accountsList" class="list-area">
                <p>Chargement...</p>
            </div>
        </section>

        <!-- TRADES SECTION -->
        <section id="trades" class="app-section">
            <h2>Trades</h2>

            <div id="tradesList" class="list-area">
                <p>Aucun trade pour le moment.</p>
            </div>
        </section>

        <!-- COACH PANEL -->
        <section id="coachPanel" class="app-section">
            <h2>Espace Coach</h2>
            <p>Validation des Ã©lÃ¨ves, etc.</p>

            <div id="coachArea"></div>
        </section>
    </main>

    <!-- =============== MODALE : AJOUT COMPTE ================ -->
    <div id="addAccountModal" class="modal">
        <div class="modal-content">

            <span class="close" onclick="closeModal('addAccountModal')">&times;</span>
            <h3>Ajouter un compte</h3>

            <form id="accountForm" onsubmit="event.preventDefault(); addAccount();">

                <label>Nom du compte :</label>
                <input id="accountName" type="text" placeholder="Ex : Apex 50K">

                <label>Taille du compte :</label>
                <input id="accountSize" type="text" placeholder="Ex : 50000 ou 50K">

                <button type="submit" class="btn-primary">Ajouter</button>
            </form>
        </div>
    </div>

    <!-- =============== SCRIPTS ================ -->
    <script src="supabase-config.js"></script>
    <script src="supabase-auth.js"></script>
    <script src="supabase-journal.js"></script>
    <script src="supabase-trades.js"></script>
    <script src="supabase-coach.js"></script>

    <script>
        /* ------------------------------------------------------
         * Gestion des sections
         * ------------------------------------------------------ */
        function showSection(id) {
            document.querySelectorAll('.app-section').forEach(section => {
                section.classList.remove('visible');
            });
            document.getElementById(id).classList.add('visible');
        }

        /* ------------------------------------------------------
         * Gestion modales
         * ------------------------------------------------------ */
        function openModal(id) {
            document.getElementById(id).style.display = "block";
        }

        function closeModal(id) {
            document.getElementById(id).style.display = "none";
        }

        /* ------------------------------------------------------
         * Chargement automatique aprÃ¨s connexion
         * ------------------------------------------------------ */
        document.addEventListener("DOMContentLoaded", async () => {
            const session = await supabase.auth.getSession();
            if (session.data.session) {
                const user = session.data.session.user;
                setCurrentUser({ uuid: user.id });
                await loadUserDataFromSupabase(user.id);
            }
        });
    </script>

</body>
</html>
